---
title: "Maximizing Efficiency in Under- and Recent Graduate Job Searching"
author: "ES3"
date: "December 9, 2017"
output: html_document
---

```{r, include=FALSE}
# install dependencies
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("rpart")
#install.packages("rattle")
#install.packages("glmnet")
#install.packages("tidyr")

# import libraries
library(dplyr)
library(ggplot2)
library(rpart)
library(rattle)
library(glmnet)
library(tidyr)

# set working directory
#setwd("~/University of Washington/Senior/Fall/Info 370/project-es3")

# load data
data <- read.csv("data/clean_num.csv")
pilot <- read.csv("data/stress_pilot.csv")

```

# Decision Context
As college students nearing the end of our undergraduate careers, all four members of this group understand the pressure that comes with finding entry-level employment. And while a wide variety of resources are available to students looking for jobs, a pilot study we conducted on 33 self-selected participants from the University of Washington Information School showed that 78.8% still found the job search process to be stressful to some degree.

```{r, echo=FALSE}
# rename column headers
colnames(pilot) <- c("class", "stress")

# order class sequentially
pilot$class <- factor(pilot$class, levels=c("Alumni", "5th year", "Senior", "Junior", "Sophomore"))

# plot stress data
ggplot(data = pilot) +
  geom_bar(mapping = aes(x = stress), width = 0.5) +
  labs(title = "Job Search Stress", x = "Stress level", y = "Number of students") +
  coord_flip(ylim = c(0, nrow(pilot)))

```

Our goal was therefore to illuminate the effectiveness of different job search resources so that students can allocate their time most productively. Our model focuses on making recommendations that minimize excess effort and time spent job searching. These include recommendations about what skills you should develop in the long term and what resources you should use in the short term.

# Results
Recommendations to guide immediate actions: 
* Avoid relying too heavily on online resources like LinkedIn, online job postings, etc.
* After applying to a lot of online postings (more than around 25), most people spend less time on cover letters and resumes. It's better to invest more effort into fewer applications. 
* If you are heavily dependent on online resources, solicit your friends/family/professors/etc. to see if anyone has connections to your organizations of interest. Leverage the ones you find.
* You have to use resources a lot to get offers from them. Doing something a little bit is unlikely to be a good use of time. Instead, pick a few resources and get really good at them.

Recommendations to guide long term planning:
* A high cumulative GPA and internship experience both correlate with shorter job search times. If you've focused more on one of these areas than the other, you're not doomed. If you haven't focused on either, you should aim to improve in at least one of the two.   

# Model
Our original model approached our question dividing respondents into two groups: those who accepted a job offer in under 3 months of searching, and those who did not. We chose the 3 month cutoff because about half of respondents fell on one side and half on the other.

```{r, echo=F}
og.model.data <- data %>%
  # reformat graduation data as date
  mutate(graduation_date = as.Date(graduation_date, "%m/%d/%Y")) %>%
  
  # split job type into 3 binary columns (1 = internship, 2 = part time, 3 = full time)
  mutate(fulltime = ifelse(Job_type == 3, 1, 0)) %>%
  mutate(parttime = ifelse(Job_type == 2, 1, 0)) %>%
  mutate(internship = ifelse(Job_type == 1, 1, 0)) %>%
  select(-Job_type) %>%
  
  # convert months to classification variable (0 = >3mo., 1 = <3mo.)
  mutate(Months = ifelse(Months <= 3, 1, 0)) %>%
  
  # split class standing into 5 binary columns
  mutate(freshman = ifelse(class_standing_ == 1, 1, 0)) %>%
  mutate(sophomore = ifelse(class_standing_ == 2, 1, 0)) %>%
  mutate(junior = ifelse(class_standing_ == 3, 1, 0)) %>%
  mutate(senior = ifelse(class_standing_ == 4, 1, 0)) %>%
  mutate(fifth.year = ifelse(class_standing_ == 5, 1, 0)) %>%
  mutate(alumni = ifelse(class_standing_ == 6, 1, 0)) %>%
  select(-class_standing_) %>%
  
  # remove test data
  # (filter out people just beginning job search (no job, searching for < 3 mo.))
  filter((has_position == 0 & Months == 0) | (None_of_these == 1 & Months == 0) | has_position == 1 | None_of_these == 0) %>%
  
  # remove factors that we don't want to predict on
  select(-None_of_these, -has_position)

# create decision tree
og.tree <- rpart(Months ~ .,
                 data = og.model.data, method = "class",
                 control=rpart.control(minbucket=1))

# plot tree
fancyRpartPlot(og.tree)

```

Unfortunately, this model didn't particularly make very much sense. For instance, it suggests if you apply to fewer online job postings but use LinkedIn more, you are more likely to accept a job offer in under 3 months. But logically we expect both factors to be a part of the same strategy - perhaps online-based one - and therefore to be directly as opposed to inversely correlated. In the process of meeting with our mentor, it was brought to our attention that the model might be making confusing suggestions becuase it was built on data from individuals who could have pursued multiple strategies in their job search.

Our solution was to analyze only individuals who got offers in the first couple months of their job search under the assumption they would have only had the chance to utilize one strategy. We looked for a natural cutoff in the data but found none so four months was chosen arbitrarily. While this method prevents us from analyzing strategies that did not work it allows us to definitively point to the strategies that did work.

```{r echo = F}
revised.model.data <- data %>%
  # reformat graduation data as date
  mutate(graduation_date = as.Date(graduation_date, "%m/%d/%Y")) %>%
  
  # split job type into 3 binary columns (1 = internship, 2 = part time, 3 = full time)
  mutate(fulltime = ifelse(Job_type == 3, 1, 0)) %>%
  mutate(parttime = ifelse(Job_type == 2, 1, 0)) %>%
  mutate(internship = ifelse(Job_type == 1, 1, 0)) %>%
  select(-Job_type) %>%
  
  # split class standing into 5 binary columns
  mutate(freshman = ifelse(class_standing_ == 1, 1, 0)) %>%
  mutate(sophomore = ifelse(class_standing_ == 2, 1, 0)) %>%
  mutate(junior = ifelse(class_standing_ == 3, 1, 0)) %>%
  mutate(senior = ifelse(class_standing_ == 4, 1, 0)) %>%
  mutate(fifth.year = ifelse(class_standing_ == 5, 1, 0)) %>%
  mutate(alumni = ifelse(class_standing_ == 6, 1, 0)) %>%
  select(-class_standing_) %>%
  
  # get subset where job found in <= 4 months
  filter(Months <= 4) %>%
  
  # remove test data
  # (filter out people just beginning job search (no job, searching for < 3 mo.))
  filter((has_position == 0 & Months == 0) | (None_of_these == 1 & Months == 0) | has_position == 1 | None_of_these == 0) %>%
  
  # remove factors that we don't want to predict on
  select(-None_of_these, -has_position)

# create decision tree
revised.tree <- rpart(Months ~ ., data = revised.model.data, method = "anova", control=rpart.control(minbucket=2))

# plot decision tree
fancyRpartPlot(revised.tree)

```

While not every aspect of the revised model makes perfect sense, the model's issues - unlike those in the original model - have more to do with our dataset's small sample size than with the model's design itself. 

## Supplemental analysis
First, we plotted scatter plot of a number of the months for job searching by a number of students at each type of job to determine when to stop job searching using the same method.

```{r echo = F}
ggplot(data = data) +
  geom_count(mapping = aes(x = Job_type, y = Months), alpha = 1/3) +     scale_size_area(max_size = 10) + 
  labs(title = "Plot of Months by Number of Students in each Type of Job", x = "Types of Job", y = "Months Job Searching Took", size = "Number of People")

```

The scatter plot is suggesting that spending maximum of 7 months is adequate for job searching. Although some students got an offer spending more than a year, it is highly recommended to change the job searching method if the months spent on job search passes 7 months.

```{R echo = F}
#GPA vs search time
ggplot(data, aes(x = cumulative_GPA, y = Months)) +
  geom_point(alpha = 0.1 ) + 
  geom_smooth(method=lm)

```

## Lasso Regression
For the multi-feature problem in linear regression, we used L1 regulation Lasso to model mean squared error.
```{r echo = F, warning= F, message = F}
month <- data[, "Months"]

# Create dataframe 
df = data.frame(data$Months, data$resume_hrs, data$cover_letter_hours, data$self.confidence, data$online_job_postings, data$no_career_fairs, data$cumulative_GPA, data$in.major_GPA, data$internships)

x <- as.matrix(df[-1]) # Removes month
y <- as.matrix(df[, 1]) # Only month

# Plot Mean Squared Error Plot and Lasso path using glmnet
cvfit <- cv.glmnet(x, y,parallel=TRUE, standardize=TRUE, alpha=1, nlambda=1000)
fit <- glmnet(x, y, standardize=TRUE, alpha=1, nlambda=1000)
plot(fit)
plot(cvfit)

```

## Coefficient of Lasso Regression
We analyzed the coefficient of lasso model in order to observe the pattern.
```{r echo = F}
head(coef(fit)) [,6:10]
```
The coefficient of lasso model shows increasing pattern of a number of career fairs student attended, despite decreasing pattern of cumulative GPA and number of internships. The number of career fairs, cumulative gpa, and internship are major factors that impact job searching.

## Scatter Plot
We plotted the observation from the coefficeint of lasso model 
```{r echo = F}
ggplot(data, aes(x= data$no_career_fairs, y = data$Months)) + geom_point(alpha = .1)
ggplot(data, aes(x= data$cumulative_GPA, y = data$Months)) + geom_point(alpha = .1)
ggplot(data, aes(x= data$internships, y = data$Months)) + geom_point(alpha = .1)
```
The graph tells us that more attendance at career fairs results in a higher number of months to find employment. This most likely just means that people who are initially unsuccessful at finding a job will continue going to career fairs, not that attending more career fairs actually makes the job search take longer. Additionally, maintaining a high cumulative GPA and gaining internship experience are related to shorter job searches.  

# Limitations
